import{setLastSavedTimeStamp,getLastSavedTimeStamp,setCurrentPrecipitationRate,getCurrentPrecipitationRate,getCurrentStarSystemWeatherEfficiency,setCurrentStarSystemWeatherEfficiency,getCurrentStarSystem,setCurrentStarSystem,getTrippedStatus,setTrippedStatus,setRanOutOfFuelWhenOn,getRanOutOfFuelWhenOn,setBuildingTypeOnOff,getBuildingTypeOnOff,setActivatedFuelBurnObject,getActivatedFuelBurnObject,setConstituentPartsObject,getConstituentPartsObject,setPowerOnOff,getPowerOnOff,setTotalEnergyUse,getTotalEnergyUse,getBuildingTypes,getTechRenderCounter,setTechRenderCounter,setTechRenderChange,getTechRenderChange,setTempRowValue,getTempRowValue,deferredActions,getCanAffordDeferred,setCanAffordDeferred,getTemporaryRowsRepo,setTemporaryRowsRepo,setOriginalFrameNumbers,getOriginalFrameNumbers,getUnlockedResourcesArray,setUnlockedResourcesArray,setRevealedTechArray,getTimerRateRatio,getTimerUpdateInterval,getCurrencySymbol,setSaleResourcePreview,setCreateCompoundPreview,setSaleCompoundPreview,getItemsToIncreasePrice,setItemsToIncreasePrice,getItemsToDeduct,setItemsToDeduct,getCurrentOptionPane,getIncreaseStorageFactor,setGameStateVariable,getMenuState,getGameVisibleActive,getElements,gameState,getCurrentTab,getRevealedTechArray,getTechUnlockedArray,getResourceSalePreview,getCompoundSalePreview,getCompoundCreatePreview,getNotationType}from"./constantsAndGlobalVars.js";import{getStarSystemDataObject,setStarSystemDataObject,getAutoBuyerTierLevel,getResourceDataObject,setResourceDataObject,getStarSystemWeather,setStarSystemWeather}from"./resourceDataObject.js";import{updateContent,sortTechRows,showNotification,showTabsUponUnlock,getTimeInStatCell}from"./ui.js";import{capitaliseString}from"./utilityFunctions.js";import{initializeAutoSave}from"./saveLoadGame.js";class TimerManager{constructor(){this.timers=new Map}addTimer(e,t,r){if(this.timers.has(e))return void console.error(`Timer with key "${e}" already exists.`);const s=new Timer(t,r);this.timers.set(e,s),s.start()}removeTimer(e){this.timers.has(e)&&(this.timers.get(e).stop(),this.timers.delete(e))}stopAllTimers(){this.timers.forEach((e=>e.stop()))}getTimer(e){return this.timers.get(e)}}class Timer{constructor(e,t){this.duration=e,this.onExpire=t,this.timerId=null}start(){this.timerId&&clearTimeout(this.timerId),this.timerId=setInterval((()=>{this.onExpire()}),this.duration)}stop(){this.timerId&&(clearInterval(this.timerId),this.timerId=null)}}const timerManager=new TimerManager;export function startGame(){setGameState(getGameVisibleActive()),updateContent("Resources","tab1","intro"),initializeAutoSave(),startInitialTimers(),gameLoop()}export async function gameLoop(){if(gameState===getGameVisibleActive()){const e=document.querySelectorAll(".notation");showTabsUponUnlock(),setEnergyUse();const t=Object.keys(getResourceDataObject("resources")),r=[];t.forEach((e=>{for(let t=1;t<=4;t++)r.push([e,t])}));const s=Object.keys(getResourceDataObject("compounds")),a=[];s.forEach((e=>{for(let t=1;t<=4;t++)a.push([e,t])})),addPrecipitationResource();let c=getAllQuantities();c=normalizeAllQuantities(c);const n=getAllStorages(),o=getAllElements(r,a),i=getAllDynamicDescriptionElements(r,a);updateRates(),updateUIQuantities(c,n,o,i),updateStats(),getItemsToDeduct()&&Object.keys(getItemsToDeduct()).length>0&&checkAndDeductResources(),getItemsToIncreasePrice()&&Object.keys(getItemsToIncreasePrice()).length>0&&checkAndIncreasePrices();document.querySelectorAll(".energy-check").forEach((e=>{checkStatusAndSetTextClasses(e)}));document.querySelectorAll(".fuel-check").forEach((e=>{checkStatusAndSetTextClasses(e)}));document.querySelectorAll(".resource-cost-sell-check, .compound-cost-sell-check").forEach((e=>{checkStatusAndSetTextClasses(e)})),checkPowerBuildingsFuelLevels();for(document.querySelectorAll(".option-row").forEach((e=>{monitorRevealRowsChecks(e)})),getBuildingTypes().forEach((e=>{checkAndRevealNewBuildings(e)})),monitorRevealResourcesCheck(),monitorRevealCompoundsCheck(),updateAllSalePricePreviews(),updateAllCreatePreviews();deferredActions.length>0;){deferredActions.shift()()}if("tech tree"===getCurrentOptionPane()){updateClassesInRowsToRender();const e=sortRowsByRenderPosition(getTemporaryRowsRepo("rows"),"techs"),t=getTemporaryRowsRepo("container");getTechRenderChange()&&(setTechRenderCounter(getTechRenderCounter()+1),getTechRenderCounter()>=150&&(e.forEach((e=>t.appendChild(e.row))),setTechRenderChange(!1),setTechRenderCounter(0)))}setAllOriginalFrameNumberValues(),e.forEach((e=>{document.body.contains(e)&&(e.classList.contains("sell-fuse-money")?(setTempRowValue(e.innerHTML),complexSellStringFormatter(e,getNotationType())):e.classList.contains("building-purchase")?(setTempRowValue(e.innerHTML),complexPurchaseBuildingFormatter(e,getNotationType())):formatAllNotationElements(e,getNotationType()))})),requestAnimationFrame(gameLoop)}}function addPrecipitationResource(){const e=getStarSystemDataObject(getCurrentStarSystem(),["precipitationResourceCategory"]),t=getStarSystemDataObject(getCurrentStarSystem(),["precipitationType"]),r=getTechUnlockedArray().includes(getResourceDataObject(e,[t,"revealedBy"]));let s=getResourceDataObject(e,[t,"quantity"]),a=getResourceDataObject(e,[t,"storageCapacity"])>s;"rain"===getCurrentStarSystemWeatherEfficiency()[2]&&r&&a&&(setResourceDataObject(s+getCurrentPrecipitationRate(),e,[t,"quantity"]),getElements().waterQuantity.textContent=getResourceDataObject(e,[t,"quantity"]))}function checkAndRevealNewBuildings(e){let t;if("energy"===e)t=getResourceDataObject("buildings",["energy","upgrades"]);for(const e in t)if(t.hasOwnProperty(e)){const r=t[e].revealedBy;if(getTechUnlockedArray().includes(r)){const t=e+"Option";document.getElementById(t).parentElement.parentElement.classList.remove("invisible")}}}function updateStats(){const e=getResourceDataObject("currency",["cash"]);"€"!==getCurrencySymbol()?getElements().cashStat.textContent=`${getCurrencySymbol()}${e.toFixed(2)}`:getElements().cashStat.textContent=`${e.toFixed(2)+getCurrencySymbol()}`,updateEnergyStat(document.getElementById("stat2")),checkStatusAndSetTextClasses(document.getElementById("stat3")),getTimeInStatCell()}function setRevealedResources(e){[["hydrogen","helium"],["helium","carbon"],["carbon","neon"],["carbon","sodium"],["neon","oxygen"],["oxygen","silicon"],["silicon","iron"]].forEach((t=>{t[0]===e&&setResourceDataObject(!0,"resources",[t[1],"revealedYet"])}))}export function fuseResource(e,t){setRevealedResources(e);const r=getResourceDataObject("resources",[e,"nameResource"]),s=getResourceDataObject("resources",[e,"quantity"]);let a=0,c=0;for(let n of t){c++;const{fuseTo:t,ratio:o,resourceRowToShow:i,categoryToShow:u,mainCategoryToShow:l}=n,d=getResourceDataObject("resources",[t,"nameResource"]),g=getResourceDataObject("resources",[t,"storageCapacity"]),y=getResourceDataObject("resources",[t,"quantity"]);let p,m,b,R=0,f=0;if(getUnlockedResourcesArray().includes(t)){let s=1;getTechUnlockedArray().includes("fusionEfficiencyI")?getTechUnlockedArray().includes("fusionEfficiencyII")?getTechUnlockedArray().includes("fusionEfficiencyIII")||(s=Math.random()*(.8-.6)+.6):s=Math.random()*(.6-.4)+.4:s=Math.random()*(.3-.2)+.2,p=getResourceSalePreview(e),m=parseInt(p.match(/\((\d+)/)[1],10),b=1===c?parseInt(p.match(/->\s*(\d+)/)[1],10):parseInt(p.match(/(?<=,\s)\d+/)[0],10),R=Math.floor(b*s);const n=Math.floor(b-R),i=Math.floor(g-y);Math.abs(m*o-b)<=1?showNotification(`Should Fuse ${m} ${r} into ${Math.floor(m*o)} ${d}. Lost ${n} ${d} as energy due to sub-optimal fusion efficiency, receive ${R} ${d}`,"info",5e3):(f=Math.max(R-i,0),showNotification(`Should Fuse ${m} ${r} into ${Math.floor(m*o)} ${d}. Max available storage is for ${i}.  Of those, ${n} lost due to sub-optimal fusion efficiency. So receive ${R-f} ${d}`,"warning",5e3));const u=Math.min(R-f,i);setResourceDataObject(y+u,"resources",[t,"quantity"]),a=m}else{i.classList.remove("invisible"),l.classList.remove("invisible"),u.classList.remove("invisible"),setUnlockedResourcesArray(t),p=getResourceSalePreview(e),m=parseInt(p.match(/\((\d+)/)[1],10);const c=Math.ceil(m*o/4);showNotification(`Discovered ${d} and made ${c} ${d} from ${m} ${r}!`,"info"),setResourceDataObject(s-m,"resources",[e,"quantity"]),setResourceDataObject(y+c,"resources",[t,"quantity"]),a=m}}setResourceDataObject(s-a,"resources",[e,"quantity"])}export function sellResource(e){const t=getResourceDataObject("resources",[e,"quantity"]),r=getResourceSalePreview(e),s=getResourceDataObject("currency",["cash"]),a=r.split(">")[1].split("<")[0].trim();let c;c="€"===getCurrencySymbol()?parseFloat(a.replace("€","").replace(",","")):parseFloat(a.slice(1).replace(",",""));const n=parseInt(r.match(/\((\d+)/)[1],10);"€"===getCurrencySymbol()?showNotification(`You sold ${n} ${capitaliseString(e)} for ${c}${getCurrencySymbol()}!`,"info"):showNotification(`You sold ${n} ${capitaliseString(e)} for ${getCurrencySymbol()}${c}!`,"info"),setResourceDataObject(t-n,"resources",[e,"quantity"]),getResourceDataObject("resources",[e,"quantity"])<1&&setResourceDataObject(0,"resources",[e,"quantity"]),setResourceDataObject(s+c,"currency",["cash"])}export function createCompound(e){const t=getConstituentPartsObject(),r=getResourceDataObject("compounds",[e,"quantity"]),s=getResourceDataObject("compounds",[e,"storageCapacity"]);let a=r+t.compoundToCreateQuantity,c=0;a>s&&(c=a-s,a=s),setResourceDataObject(a,"compounds",[e,"quantity"]);let n=[];for(let e=1;e<=4;e++){const r=`constituentPartQuantity${e}`,s=t[`constituentPartName${e}`],a=t[r];if(s&&a>0){let e;e=getResourceDataObject("resources")[s]?"resources":getResourceDataObject("compounds")[s]?"compounds":"error",setResourceDataObject(getResourceDataObject(e,[s,"quantity"])-a,e,[s,"quantity"]),n.push(`${a} ${capitaliseString(s)}`)}}const o=t.compoundToCreateQuantity,i=capitaliseString(e);c>0?showNotification(`You created ${o} ${i} from ${n.join(", ")} but ${c} ${i} was wasted due to storage limit being exceeded.`,"warning"):showNotification(`You created ${o} ${i} from ${n.join(", ")}`,"info")}export function sellCompound(e){const t=getResourceDataObject("compounds",[e,"quantity"]),r=getCompoundSalePreview(e),s=getResourceDataObject("currency",["cash"]);let a,c=r.split(">")[1].split("<")[0].trim();a="€"===getCurrencySymbol()?parseFloat(c.replace("€","").replace(",","")):parseFloat(c.slice(1).replace(",",""));const n=parseInt(r.match(/\((\d+)/)[1],10);setResourceDataObject(t-n,"compounds",[e,"quantity"]),getResourceDataObject("compounds",[e,"quantity"])<1&&setResourceDataObject(0,"compounds",[e,"quantity"]),setResourceDataObject(s+a,"currency",["cash"]),"€"===getCurrencySymbol()?showNotification(`You sold ${n} ${capitaliseString(e)} for ${a}${getCurrencySymbol()}!`,"info"):showNotification(`You sold ${n} ${capitaliseString(e)} for ${getCurrencySymbol()}${a}!`,"info")}function updateAllCreatePreviews(){const e=getCurrentOptionPane(),t=getResourceDataObject("compounds");for(const r in t)if(r===e){const s=r+"CreateSelectQuantity";setCreateCompoundPreview(e,document.getElementById(s).value);let a=cleanString(getCompoundCreatePreview(r));const c=t[r]?.createPreviewElement,n=document.getElementById(c);n&&(n.innerHTML=a)}}function updateAllSalePricePreviews(){const e=getCurrentOptionPane(),t=getResourceDataObject("resources"),r=getResourceDataObject("compounds");for(const r in t){const s=t[r]?.fuseTo1,a=t[r]?.fuseTo2;if(r===e){const c=r+"SellSelectQuantity";setSaleResourcePreview(e,document.getElementById(c).value,s,a);let n=cleanString(getResourceSalePreview(r));const o=t[r]?.salePreviewElement,i=document.getElementById(o);i&&(i.innerHTML=n)}}for(const t in r)if(t===e){const s=t+"SellSelectQuantity";setSaleCompoundPreview(e,document.getElementById(s).value);let a=cleanString(getCompoundSalePreview(t));const c=r[t]?.salePreviewElement,n=document.getElementById(c);n&&(n.innerHTML=a)}}function cleanString(e){return e.includes("NaN")||e.includes(", 0 )")?e.split(",")[0]+")":e.includes(", 0 !)")?e.split(",")[0]+"!)":e.includes(", 0 !!)")?e.split(",")[0]+"!!)":e.includes(" ()")?e.replace(" ()",""):e}function checkAndIncreasePrices(){const e=getItemsToIncreasePrice();for(const t in e)""===t&&delete e[t];for(const t in e)if(e.hasOwnProperty(t)&&getCanAffordDeferred()){const{currentPrice:r,setPriceTarget:s,typeOfResourceCompound:a}=e[t];if(s.startsWith("science"))setNewItemPrice(r,s,null,null,null);else if(s.startsWith("power")||s.startsWith("battery"))setNewItemPrice(r,s,null,null,"cash"===t?t:e);else{const e=s.match(new RegExp(`${t}AB(\\d+)Price`));if(e&&e[1]){setNewItemPrice(r,s,parseInt(e[1],10),a,null)}}}setItemsToIncreasePrice("clear")}function setNewItemPrice(e,t,r,s,a){let c=0,n=0,o=0,i="",u="",l="",d="",g="",y="";if(t){const p=Math.ceil(1.15*e);if(a&&"cash"!==a)for(const e in a)if(a.hasOwnProperty(e)&&"cash"!==e){const t=a[e],r=t.resourceOrder;"resource1Price"===r?(c=t.currentPrice,i=e,d=t.typeOfResourceCompound):"resource2Price"===r?(n=t.currentPrice,u=e,g=t.typeOfResourceCompound):"resource3Price"===r&&(o=t.currentPrice,l=e,y=t.typeOfResourceCompound)}let m=c>0?Math.ceil(1.15*c):0,b=n>0?Math.ceil(1.15*n):0,R=o>0?Math.ceil(1.15*o):0;if(m>0&&(m=[m,i,d]),b>0&&(b=[b,u,g]),R>0&&(R=[R,l,y]),t.startsWith("science")){const e=t.slice(0,-5);setResourceDataObject(p,"research",["upgrades",e,"price"])}else if(t.startsWith("power")||t.startsWith("battery")){const e=t.slice(0,-5);"cash"===a&&setResourceDataObject(p,"buildings",["energy","upgrades",e,"price"]),c>0&&setResourceDataObject(m,"buildings",["energy","upgrades",e,"resource1Price"]),n>0&&setResourceDataObject(b,"buildings",["energy","upgrades",e,"resource2Price"]),o>0&&setResourceDataObject(R,"buildings",["energy","upgrades",e,"resource3Price"])}else{const e=t.replace(/([A-Z])/g,"-$1").toLowerCase().split("-")[0];setResourceDataObject(p,s,[e,"upgrades","autoBuyer",`tier${r}`,"price"])}}}function checkAndDeductResources(){const e=getItemsToDeduct();let t,r;for(const t in e)(""===t||t.includes(","))&&delete e[t];for(const s in e)if(e.hasOwnProperty(s)){let a;t=e[s].deductQuantity;const c=e[s].typeOfResourceCompound;"cash"===s?(r="currency",a=getResourceDataObject(r,[s]),t>a?setCanAffordDeferred(!1):(setResourceDataObject(a-t,r,[s]),setCanAffordDeferred(!0))):"research"===s?(r="research",a=getResourceDataObject(r,["quantity"]),t>a?setCanAffordDeferred(!1):(setResourceDataObject(a-t,r,["quantity"]),setCanAffordDeferred(!0))):(r=c,a=getResourceDataObject(r,[s,"quantity"]),t>a?setCanAffordDeferred(!1):(setResourceDataObject(a-t,r,[s,"quantity"]),setCanAffordDeferred(!0)))}setItemsToDeduct("clear")}function getAllQuantities(){const e=Object.keys(getResourceDataObject("resources")),t=Object.keys(getResourceDataObject("compounds")),r={};return e.forEach((e=>{const t=e;r[t]=getResourceDataObject("resources",[t,"quantity"]),r[`${t}AB1Quantity`]=getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier1","quantity"]),r[`${t}AB2Quantity`]=getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier2","quantity"]),r[`${t}AB3Quantity`]=getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier3","quantity"]),r[`${t}AB4Quantity`]=getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier4","quantity"])})),t.forEach((e=>{const t=e;r[t]=getResourceDataObject("compounds",[t,"quantity"]),r[`${t}AB1Quantity`]=getResourceDataObject("compounds",[t,"upgrades","autoBuyer","tier1","quantity"]),r[`${t}AB2Quantity`]=getResourceDataObject("compounds",[t,"upgrades","autoBuyer","tier2","quantity"]),r[`${t}AB3Quantity`]=getResourceDataObject("compounds",[t,"upgrades","autoBuyer","tier3","quantity"]),r[`${t}AB4Quantity`]=getResourceDataObject("compounds",[t,"upgrades","autoBuyer","tier4","quantity"])})),r.energy=getResourceDataObject("buildings",["energy","quantity"]),r.battery1=getResourceDataObject("buildings",["energy","upgrades","battery1","quantity"]),r.battery2=getResourceDataObject("buildings",["energy","upgrades","battery2","quantity"]),r.battery3=getResourceDataObject("buildings",["energy","upgrades","battery3","quantity"]),r.powerPlant1=getResourceDataObject("buildings",["energy","upgrades","powerPlant1","quantity"]),r.powerPlant2=getResourceDataObject("buildings",["energy","upgrades","powerPlant2","quantity"]),r.powerPlant3=getResourceDataObject("buildings",["energy","upgrades","powerPlant3","quantity"]),r.research=getResourceDataObject("research",["quantity"]),r.scienceKit=getResourceDataObject("research",["upgrades","scienceKit","quantity"]),r.scienceClub=getResourceDataObject("research",["upgrades","scienceClub","quantity"]),r.scienceLab=getResourceDataObject("research",["upgrades","scienceLab","quantity"]),r}function getAllStorages(){const e=Object.keys(getResourceDataObject("resources")),t=Object.keys(getResourceDataObject("compounds")),r={};return e.forEach((e=>{const t=e;r[t]=getResourceDataObject("resources",[t,"storageCapacity"])})),t.forEach((e=>{const t=e;r[t]=getResourceDataObject("compounds",[t,"storageCapacity"])})),r.energy=getResourceDataObject("buildings",["energy","storageCapacity"]),r.battery1=null,r.battery2=null,r.battery3=null,r.powerPlant1=null,r.powerPlant2=null,r.powerPlant3=null,r.research=null,r.scienceKit=null,r.scienceClub=null,r.scienceLab=null,r}function getAllElements(e,t){const r=[],s=[],a={};return e.forEach((e=>{r.includes(e[0])||(r.push(e[0]),a[e[0]]=getElements()[`${e[0]}Quantity`],a[`${e[0]}AB1Quantity`]=document.getElementById(`${e[0]}AB1Quantity`),a[`${e[0]}AB2Quantity`]=document.getElementById(`${e[0]}AB2Quantity`),a[`${e[0]}AB3Quantity`]=document.getElementById(`${e[0]}AB3Quantity`),a[`${e[0]}AB4Quantity`]=document.getElementById(`${e[0]}AB4Quantity`))})),t.forEach((e=>{s.includes(e[0])||(s.push(e[0]),a[e[0]]=getElements()[`${e[0]}Quantity`],a[`${e[0]}AB1Quantity`]=document.getElementById(`${e[0]}AB1Quantity`),a[`${e[0]}AB2Quantity`]=document.getElementById(`${e[0]}AB2Quantity`),a[`${e[0]}AB3Quantity`]=document.getElementById(`${e[0]}AB3Quantity`),a[`${e[0]}AB4Quantity`]=document.getElementById(`${e[0]}AB4Quantity`))})),a.energy=getElements().energyQuantity,a.battery1=getElements().battery1Quantity,a.battery2=getElements().battery2Quantity,a.battery3=getElements().battery3Quantity,a.powerPlant1=getElements().powerPlant1Quantity,a.powerPlant2=getElements().powerPlant2Quantity,a.powerPlant3=getElements().powerPlant3Quantity,a.research=getElements().researchQuantity,a.scienceKit=getElements().scienceKitQuantity,a.scienceClub=getElements().scienceClubQuantity,a.scienceLab=getElements().scienceLabQuantity,a}function getAllDynamicDescriptionElements(e,t){const r={};e.forEach((([e,t])=>{const s=document.getElementById(`${e}IncreaseContainerSizeDescription`),a=getResourceDataObject("resources",[e,"storageCapacity"]-1),c=document.getElementById(`${e}AutoBuyerTier${t}Description`),n=getResourceDataObject("resources",[e,"upgrades","autoBuyer",`tier${t}`,"price"]);r[`${e}IncreaseStorage`]={element:s,price:a,string1:`${capitaliseString(e)}`},r[`${e}AutoBuyerTier${t}`]={element:c,price:n,string1:`${capitaliseString(e)}`}})),t.forEach((([e,t])=>{const s=document.getElementById(`${e}IncreaseContainerSizeDescription`),a=getResourceDataObject("compounds",[e,"storageCapacity"]-1),c=document.getElementById(`${e}AutoBuyerTier${t}Description`),n=getResourceDataObject("compounds",[e,"upgrades","autoBuyer",`tier${t}`,"price"]);r[`${e}IncreaseStorage`]={element:s,price:a,string1:`${capitaliseString(e)}`},r[`${e}AutoBuyerTier${t}`]={element:c,price:n,string1:`${capitaliseString(e)}`}}));const s=getScienceResourceDescriptionElements(),a=getBuildingResourceDescriptionElements();return Object.assign(r,s,a),r}function getScienceResourceDescriptionElements(){const e=document.getElementById("scienceKitDescription"),t=getResourceDataObject("research",["upgrades","scienceKit","price"]),r=getResourceDataObject("research",["upgrades","scienceKit","resource1Price"])[0],s=getResourceDataObject("research",["upgrades","scienceKit","resource2Price"])[0],a=getResourceDataObject("research",["upgrades","scienceKit","resource3Price"])[0],c=document.getElementById("openScienceClubDescription"),n=getResourceDataObject("research",["upgrades","scienceClub","price"]),o=getResourceDataObject("research",["upgrades","scienceClub","resource1Price"])[0],i=getResourceDataObject("research",["upgrades","scienceClub","resource2Price"])[0],u=getResourceDataObject("research",["upgrades","scienceClub","resource3Price"])[0],l=document.getElementById("openScienceLabDescription"),d=getResourceDataObject("research",["upgrades","scienceLab","price"]),g=getResourceDataObject("research",["upgrades","scienceLab","resource1Price"])[0],y=getResourceDataObject("research",["upgrades","scienceLab","resource2Price"])[0],p=getResourceDataObject("research",["upgrades","scienceLab","resource3Price"])[0];return{scienceKitBuy:{element:e,price:t,resource1Price:r,resource2Price:s,resource3Price:a,string1:getCurrencySymbol(),string2:capitaliseString(getResourceDataObject("research",["upgrades","scienceKit","resource1Price"])[1]),string3:capitaliseString(getResourceDataObject("research",["upgrades","scienceKit","resource2Price"])[1]),string4:capitaliseString(getResourceDataObject("research",["upgrades","scienceKit","resource3Price"])[1])},scienceClubBuy:{element:c,price:n,resource1Price:o,resource2Price:i,resource3Price:u,string1:getCurrencySymbol(),string2:capitaliseString(getResourceDataObject("research",["upgrades","scienceClub","resource1Price"])[1]),string3:capitaliseString(getResourceDataObject("research",["upgrades","scienceClub","resource2Price"])[1]),string4:capitaliseString(getResourceDataObject("research",["upgrades","scienceClub","resource3Price"])[1])},scienceLabBuy:{element:l,price:d,resource1Price:g,resource2Price:y,resource3Price:p,string1:getCurrencySymbol(),string2:capitaliseString(getResourceDataObject("research",["upgrades","scienceLab","resource1Price"])[1]),string3:capitaliseString(getResourceDataObject("research",["upgrades","scienceLab","resource2Price"])[1]),string4:capitaliseString(getResourceDataObject("research",["upgrades","scienceLab","resource3Price"])[1])}}}function getBuildingResourceDescriptionElements(){const e=document.getElementById("sodiumIonBatteryDescription"),t=getResourceDataObject("buildings",["energy","upgrades","battery1","price"]),r=getResourceDataObject("buildings",["energy","upgrades","battery1","resource1Price"])[0],s=getResourceDataObject("buildings",["energy","upgrades","battery1","resource2Price"])[0],a=getResourceDataObject("buildings",["energy","upgrades","battery1","resource3Price"])[0],c=document.getElementById("battery2Description"),n=getResourceDataObject("buildings",["energy","upgrades","battery2","price"]),o=getResourceDataObject("buildings",["energy","upgrades","battery2","resource1Price"])[0],i=getResourceDataObject("buildings",["energy","upgrades","battery2","resource2Price"])[0],u=getResourceDataObject("buildings",["energy","upgrades","battery2","resource3Price"])[0],l=document.getElementById("battery3Description"),d=getResourceDataObject("buildings",["energy","upgrades","battery3","price"]),g=getResourceDataObject("buildings",["energy","upgrades","battery3","resource1Price"])[0],y=getResourceDataObject("buildings",["energy","upgrades","battery3","resource2Price"])[0],p=getResourceDataObject("buildings",["energy","upgrades","battery3","resource3Price"])[0],m=document.getElementById("powerPlantDescription"),b=getResourceDataObject("buildings",["energy","upgrades","powerPlant1","price"]),R=getResourceDataObject("buildings",["energy","upgrades","powerPlant1","resource1Price"])[0],f=getResourceDataObject("buildings",["energy","upgrades","powerPlant1","resource2Price"])[0],O=getResourceDataObject("buildings",["energy","upgrades","powerPlant1","resource3Price"])[0],h=document.getElementById("solarPowerPlantDescription"),j=getResourceDataObject("buildings",["energy","upgrades","powerPlant2","price"]),D=getResourceDataObject("buildings",["energy","upgrades","powerPlant2","resource1Price"])[0],C=getResourceDataObject("buildings",["energy","upgrades","powerPlant2","resource2Price"])[0],P=getResourceDataObject("buildings",["energy","upgrades","powerPlant2","resource3Price"])[0],x=document.getElementById("advancedPowerPlantDescription"),E=getResourceDataObject("buildings",["energy","upgrades","powerPlant3","price"]),L=getResourceDataObject("buildings",["energy","upgrades","powerPlant3","resource1Price"])[0],S=getResourceDataObject("buildings",["energy","upgrades","powerPlant3","resource2Price"])[0],T=getResourceDataObject("buildings",["energy","upgrades","powerPlant3","resource3Price"])[0];return{battery1Buy:{element:e,price:t,resource1Price:r,resource2Price:s,resource3Price:a,string1:getCurrencySymbol(),string2:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","battery1","resource1Price"])[1]),string3:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","battery1","resource2Price"])[1]),string4:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","battery1","resource3Price"])[1])},battery2Buy:{element:c,price:n,resource1Price:o,resource2Price:i,resource3Price:u,string1:getCurrencySymbol(),string2:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","battery2","resource1Price"])[1]),string3:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","battery2","resource2Price"])[1]),string4:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","battery2","resource3Price"])[1])},battery3Buy:{element:l,price:d,resource1Price:g,resource2Price:y,resource3Price:p,string1:getCurrencySymbol(),string2:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","battery3","resource1Price"])[1]),string3:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","battery3","resource2Price"])[1]),string4:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","battery3","resource3Price"])[1])},powerPlant1Buy:{element:m,price:b,resource1Price:R,resource2Price:f,resource3Price:O,string1:getCurrencySymbol(),string2:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","powerPlant1","resource1Price"])[1]),string3:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","powerPlant1","resource2Price"])[1]),string4:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","powerPlant1","resource3Price"])[1])},powerPlant2Buy:{element:h,price:j,resource1Price:D,resource2Price:C,resource3Price:P,string1:getCurrencySymbol(),string2:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","powerPlant2","resource1Price"])[1]),string3:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","powerPlant2","resource2Price"])[1]),string4:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","powerPlant2","resource3Price"])[1])},powerPlant3Buy:{element:x,price:E,resource1Price:L,resource2Price:S,resource3Price:T,string1:getCurrencySymbol(),string2:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","powerPlant3","resource1Price"])[1]),string3:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","powerPlant3","resource2Price"])[1]),string4:capitaliseString(getResourceDataObject("buildings",["energy","upgrades","powerPlant3","resource3Price"])[1])}}}function updateRates(){let e;e=getPowerOnOff()?getResourceDataObject("research",["rate"])*getTimerRateRatio():(getResourceDataObject("research",["rate"])-getResourceDataObject("research",["ratePower"]))*getTimerRateRatio(),getElements().researchRate.textContent=Math.floor(e)+" / s"}function updateUIQuantities(e,t,r,s){for(const s in e){if(e.hasOwnProperty(s)){const a=e[s],c=t[s],n=r[s];updateQuantityDisplays(n,a,c,null,null,null,!1)}if(s.startsWith("science")){const t=e[s],r=document.getElementById(`${s}Quantity`);r&&t&&(r.textContent=`Quantity: ${t}`)}if(s.includes("AB")){let t;const r=e[s],a=s.match(/AB(\d+)/);if(!a)return null;t=parseInt(a[1],10);const c=document.getElementById(s);c&&(c.textContent=`Quantity: ${r}`)}}for(const e in s){let t,r,a;if(s.hasOwnProperty(e)){const c=s[e].price;e.endsWith("Buy")&&(t=s[e].resource1Price,r=s[e].resource2Price,a=s[e].resource3Price);const n=s[e].string1,o=s[e].string2,i=s[e].string3,u=s[e].string4,l=s[e].element;updateQuantityDisplays(l,c,n,[t,o],[r,i],[a,u],!0)}}}function manageTabSpecificUi(){const e=getCurrentTab(),t=document.querySelectorAll(`.tab-${e}`);document.querySelectorAll('[class^="tab-"]').forEach((t=>{const r=t.className.match(/tab-(\d+)/);if(r){parseInt(r[1],10)!==e&&(t.classList.remove("d-flex"),t.classList.add("d-none"))}})),t.length>0?(t.forEach((e=>{e.classList.remove("d-none"),e.classList.add("d-flex")})),console.log(`Showing UI for Tab ${e}.`)):console.log(`No tab-specific UI to show for Tab ${e}, but other tabs are hidden.`)}function monitorRevealResourcesCheck(){let e,t;const r=Object.keys(getResourceDataObject("resources"));for(const s of r)e=getResourceDataObject("resources",[s,"revealedYet"]),t=s+"Option",e&&(document.getElementById(t).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.classList.remove("invisible"),document.getElementById(t).parentElement.parentElement.parentElement.parentElement.classList.remove("invisible"),document.getElementById(t).parentElement.parentElement.classList.remove("invisible"))}function monitorRevealCompoundsCheck(){let e;const t=Object.keys(getResourceDataObject("compounds"));for(const r of t){e=getResourceDataObject("compounds",[r,"revealedBy"]);const t=r+"Option";getTechUnlockedArray().includes(e)&&(document.getElementById(t).parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.classList.remove("invisible"),document.getElementById(t).parentElement.parentElement.parentElement.parentElement.classList.remove("invisible"),document.getElementById(t).parentElement.parentElement.classList.remove("invisible"))}}function monitorRevealRowsChecks(e){if(e.classList.contains("invisible")&&"techUnlock"===e.dataset.conditionCheck)getRevealedTechArray().includes(e.dataset.type)?(e.classList.remove("invisible"),setTechRenderChange(!0)):!getRevealedTechArray().includes(e.dataset.type)&&getResourceDataObject("research",["quantity"])>=getResourceDataObject("techs",[e.dataset.type,"appearsAt"])[0]&&(e.classList.remove("invisible"),setTechRenderChange(!0),setRevealedTechArray(e.dataset.type));else if("upgradeCheck"===e.dataset.conditionCheck&&"autoBuyer"===e.dataset.type){const t=parseInt(e.dataset.autoBuyerTier.slice(-1));1===getCurrentTab()&&"resource"===e.dataset.rowCategory?t>0&&t<=getAutoBuyerTierLevel(getCurrentOptionPane(),"resources")?e.classList.remove("invisible"):e.classList.add("invisible"):4===getCurrentTab()&&"compound"===e.dataset.rowCategory&&(t>0&&t<=getAutoBuyerTierLevel(getCurrentOptionPane(),"compounds")?e.classList.remove("invisible"):e.classList.add("invisible"))}}function checkStatusAndSetTextClasses(e){if(e.classList.contains("fuel-check")){if("button"===e.tagName.toLowerCase()){const t=e.dataset.toggleTarget,r=getResourceDataObject("buildings",["energy","upgrades",t,"quantity"]),s=getResourceDataObject("buildings",["energy","upgrades",t,"fuel"])[0],a=getResourceDataObject("buildings",["energy","upgrades",t,"fuel"])[2],c=getResourceDataObject(a,[s,"quantity"]),n=document.getElementById(t+"FuelType"),o=document.getElementById(t+"FuelQuantity");r>0&&(e.classList.remove("invisible"),n.classList.remove("invisible"),o.classList.remove("invisible"),c<=0?(e.textContent="Activate",e.classList.add("red-disabled-text"),n.classList.add("red-disabled-text"),o.classList.add("red-disabled-text"),n.classList.remove("green-ready-text"),o.classList.remove("green-ready-text")):(getBuildingTypeOnOff(t)&&(e.textContent="Deactivate"),e.classList.remove("red-disabled-text"),n.classList.remove("red-disabled-text"),o.classList.remove("red-disabled-text"),n.classList.add("green-ready-text"),o.classList.add("green-ready-text")),o.textContent=Math.floor(c))}}else if(e.classList.contains("energy-check")){const t=e.textContent.match(/(-?\d+(\.\d+)?) KW \/ s/);if(t){parseFloat(t[1])<0?e.classList.add("red-disabled-text"):e.classList.remove("red-disabled-text")}}else if(e.classList.contains("powered-check"))getResourceDataObject("buildings",["energy","batteryBoughtYet"])?getResourceDataObject("buildings",["energy","quantity"])>1e-5?(e.textContent="• ON",e.classList.remove("red-disabled-text"),e.classList.add("green-ready-text")):(e.textContent="• OFF",e.classList.add("red-disabled-text"),e.classList.remove("green-ready-text")):getResourceDataObject("buildings",["energy","rate"])>0?(e.textContent="• ON",e.classList.remove("red-disabled-text"),e.classList.add("green-ready-text")):(e.textContent="• OFF",e.classList.add("red-disabled-text"),e.classList.remove("green-ready-text"));else{if(e.classList.contains("compound-cost-sell-check")&&e.dataset&&"undefined"!==e.dataset.conditionCheck&&"undefined"!==e.dataset.resourcePriceObject){let t,r=e.dataset.type;const s=e.dataset.type;"storage"!==r&&"autoBuyer"!==r||(r=e.dataset.argumentCheckQuantity,t=e.dataset.argumentCheckQuantity2);const a=e.dataset.argumentCheckQuantity,c=e.dataset.argumentCheckQuantity2;let n,o,i,u,l=getResourceDataObject("compounds",[a,"quantity"]);if(t&&(n=getResourceDataObject("compounds",[c,"quantity"])),e.classList.contains("sell")||"sellCompound"===e.dataset.conditionCheck)return void(l>0?e.classList.remove("red-disabled-text"):e.classList.add("red-disabled-text"));if(e.classList.contains("create")||"createCompound"===e.dataset.conditionCheck){const t=document.getElementById("create"+capitaliseString(a)+"Description").innerHTML,r=e.parentElement.nextElementSibling.querySelector("label");r.textContent.startsWith("0")?(r.classList.remove("warning-orange-text"),r.classList.add("red-disabled-text")):r.classList.remove("red-disabled-text");let s=getConstituentComponents(t);s=unpackConstituentPartsObject(s),setConstituentPartsObject(s);let c=!1;for(let t=1;t<=4;t++){const r=`constituentPartQuantity${t}`,a=s[`constituentPartName${t}`],n=s[r];if(s.compoundToCreateQuantity<=0){c=!0;break}if(!a||n<=0)continue;if(getResourceDataObject("resources",[a,"quantity"])<n){e.classList.remove("warning-orange-text"),e.classList.add("red-disabled-text"),setSellFuseCreateTextDescriptionClassesBasedOnButtonStates(e,"create"),c=!0;break}}return void(c||(t.includes("!")&&e.classList.add("warning-orange-text"),t.includes("!")||e.classList.remove("warning-orange-text"),getPowerOnOff()?e.classList.remove("red-disabled-text"):e.classList.add("red-disabled-text"),setSellFuseCreateTextDescriptionClassesBasedOnButtonStates(e,"create")))}if("autoBuyer"===s){u="compounds";const t=e.dataset.autoBuyerTier;if("tier0"===t)return;o=getResourceDataObject(u,[r,"upgrades","autoBuyer",t,"price"]),i=0}else if("storage"===e.dataset.type)if(u="compounds",o=getResourceDataObject(u,[r,"storageCapacity"])-1,"button"!==e.tagName.toLowerCase()){i=t?Math.floor(.3*getResourceDataObject(u,[r,"storageCapacity"])):0;const s=`${o} ${getResourceDataObject(u,[r,"nameResource"])}`,a=i>0?`, ${i} ${getResourceDataObject(u,[t,"nameResource"])}`:"",c=document.createElement("span");c.id="mainCompoundPriceText",c.textContent=s;const n=document.createElement("span");n.id="secondaryCompoundPriceText",n.textContent=a,e.textContent="",e.appendChild(c),e.appendChild(n)}else i=0;"upgradeCheck"===e.dataset.conditionCheck&&l>=o&&n>=i?("button"!==e.tagName.toLowerCase()&&i>0&&(document.getElementById("mainCompoundPriceText").classList.add("green-ready-text"),document.getElementById("secondaryCompoundPriceText").classList.add("green-ready-text"),document.getElementById("mainCompoundPriceText").classList.remove("red-disabled-text"),document.getElementById("secondaryCompoundPriceText").classList.remove("red-disabled-text")),e.classList.remove("red-disabled-text")):"button"!==e.tagName.toLowerCase()&&i>0?(l<o?(document.getElementById("mainCompoundPriceText").classList.add("red-disabled-text"),document.getElementById("mainCompoundPriceText").classList.remove("green-ready-text"),e.classList.add("red-disabled-text")):document.getElementById("mainCompoundPriceText").classList.add("green-ready-text"),n<i?(document.getElementById("secondaryCompoundPriceText").classList.add("red-disabled-text"),document.getElementById("secondaryCompoundPriceText").classList.remove("green-ready-text"),e.classList.add("red-disabled-text")):document.getElementById("secondaryCompoundPriceText").classList.add("green-ready-text"),l>=o&&n>=i&&e.classList.remove("red-disabled-text")):"button"!==e.tagName.toLowerCase()?l<o?e.classList.add("red-disabled-text"):e.classList.remove("red-disabled-text"):e.parentElement.parentElement.querySelector(".description-container").firstChild.classList.contains("red-disabled-text")?e.classList.add("red-disabled-text"):e.classList.remove("red-disabled-text"),getElements()[r+"Rate"].textContent.includes("-")?getElements()[r+"Rate"].classList.add("red-disabled-text"):getElements()[r+"Rate"].classList.remove("red-disabled-text")}if(e.classList.contains("resource-cost-sell-check")&&e.dataset&&"undefined"!==e.dataset.conditionCheck&&"undefined"!==e.dataset.resourcePriceObject){let t=e.dataset.type;const r=e.dataset.type,s=e.dataset.type,a=e.dataset.resourceToFuseTo,c=e.dataset.resourceToFuseTo,n=e.dataset.resourceToFuseTo;"storage"!==t&&"autoBuyer"!==t||(t=e.dataset.argumentCheckQuantity);const o=e.dataset.argumentCheckQuantity;let i,u,l;if(i="cash"===o?getResourceDataObject("currency",["cash"]):"research"===o?getResourceDataObject("research",["quantity"]):getResourceDataObject("resources",[o,"quantity"]),e.classList.contains("sell")||"sellResource"===e.dataset.conditionCheck)return void(i>0?e.classList.remove("red-disabled-text"):e.classList.add("red-disabled-text"));if(e.classList.contains("fuse")||"fuseResource"===e.dataset.conditionCheck)return getTechUnlockedArray().includes(t+"Fusion")&&getUnlockedResourcesArray().includes(a)&&e.classList.remove("invisible"),void(getTechUnlockedArray().includes(t+"Fusion")&&i>0?(e.classList.remove("red-disabled-text"),"button"===e.tagName.toLowerCase()&&setSellFuseCreateTextDescriptionClassesBasedOnButtonStates(e,"fuse")):getTechUnlockedArray().includes(t+"Fusion")?(e.classList.remove("warning-orange-text"),e.classList.add("red-disabled-text")):e.classList.add("invisible"));if(e.classList.contains("tech-unlock")||"techUnlock"===e.dataset.conditionCheck){const t=getResourceDataObject("techs",[r,"appearsAt"]).slice(1).filter((e=>null!==e&&""!==e));if(e&&i>=getResourceDataObject("techs",[r,"price"])?e.classList.remove("red-disabled-text"):e&&e.classList.add("red-disabled-text"),"button"===e.tagName.toLowerCase()){if(i>=getResourceDataObject("techs",[r,"price"])){t.every((e=>getTechUnlockedArray().includes(e)))?e.classList.remove("red-disabled-text"):e.classList.add("red-disabled-text")}}else{const t=e.querySelector("span");if(t){const r=t.textContent.trim();if(""!==r&&"button"!==e.tagName.toLowerCase()||"button"===e.tagName.toLowerCase()){const e=r.split(", ");t.innerHTML="",e.forEach(((r,s)=>{const a=document.createElement("span");a.textContent=r.trim();const c=r.charAt(0).toLowerCase()+r.slice(1).replace(/\s+/g,"");getTechUnlockedArray().includes(c)?(a.classList.add("green-ready-text"),a.classList.remove("red-disabled-text")):(a.classList.remove("green-ready-text"),a.classList.add("red-disabled-text")),t.appendChild(a),s<e.length-1&&t.appendChild(document.createTextNode(", "))}))}}}return void(getTechUnlockedArray().includes(r)&&("button"===e.tagName.toLowerCase()&&setSellFuseCreateTextDescriptionClassesBasedOnButtonStates(e,"green"),e.classList.remove("red-disabled-text"),e.classList.add("green-ready-text"),e.textContent="Researched",e.style.pointerEvents="none",setTechRenderChange(!0)))}if("autoBuyer"===s){l="resources";const r=e.dataset.autoBuyerTier;if("tier0"===r)return;u=getResourceDataObject(l,[t,"upgrades","autoBuyer",r,"price"])}else"scienceUpgrade"===s?(l="research",u=getResourceDataObject(l,["upgrades",c,"price"])):"energy"===s?(l="buildings",u=getResourceDataObject(l,[t,"upgrades",n,"price"])):"research"===e.dataset.type?(l="research",u=getResourceDataObject(l,["quantity"])):"storage"===e.dataset.type&&(l="resources",u=getResourceDataObject(l,[t,"storageCapacity"])-1,"button"!==e.tagName.toLowerCase()&&(e.textContent=`${u} ${getResourceDataObject(l,[t,"nameResource"])}`));let d=[],g=[],y=[];if(e.classList.contains("building-purchase")&&(d.push(getResourceDataObject("buildings",["energy","upgrades",n,"resource1Price"])[0],getResourceDataObject("buildings",["energy","upgrades",n,"resource2Price"])[0],getResourceDataObject("buildings",["energy","upgrades",n,"resource3Price"])[0]),g.push(getResourceDataObject("buildings",["energy","upgrades",n,"resource1Price"])[1],getResourceDataObject("buildings",["energy","upgrades",n,"resource2Price"])[1],getResourceDataObject("buildings",["energy","upgrades",n,"resource3Price"])[1]),y.push(getResourceDataObject("buildings",["energy","upgrades",n,"resource1Price"])[2],getResourceDataObject("buildings",["energy","upgrades",n,"resource2Price"])[2],getResourceDataObject("buildings",["energy","upgrades",n,"resource3Price"])[2])),"upgradeCheck"===e.dataset.conditionCheck&&i>=u?e.classList.remove("red-disabled-text"):e.classList.add("red-disabled-text"),"upgradeCheck"===e.dataset.conditionCheck&&i>=u?e.classList.contains("building-purchase")?e.querySelectorAll("span").forEach(((t,r)=>{if(0!==r){const e=y[r-1],s=g[r-1],a=d[r-1];e&&getResourceDataObject(e,[s,"quantity"])>a?(t.classList.remove("red-disabled-text"),t.classList.add("green-ready-text")):e&&(t.classList.add("red-disabled-text"),t.classList.remove("green-ready-text"))}else"upgradeCheck"===e.dataset.conditionCheck&&i>=u?(t.classList.remove("red-disabled-text"),t.classList.add("green-ready-text")):(t.classList.add("red-disabled-text"),t.classList.remove("green-ready-text"))})):e.classList.remove("red-disabled-text"):e.classList.contains("building-purchase")&&!e.classList.contains("building-purchase-button")?e.querySelectorAll("span").forEach(((t,r)=>{if(0!==r){const e=y[r-1],s=g[r-1],a=d[r-1];e&&getResourceDataObject(e,[s,"quantity"])>a?(t.classList.remove("red-disabled-text"),t.classList.add("green-ready-text")):e&&(t.classList.add("red-disabled-text"),t.classList.remove("green-ready-text"))}else"upgradeCheck"===e.dataset.conditionCheck&&i>=u?(t.classList.remove("red-disabled-text"),t.classList.add("green-ready-text")):(t.classList.add("red-disabled-text"),t.classList.remove("green-ready-text"))})):e.classList.add("red-disabled-text"),e.classList.contains("building-purchase")){const t=e.querySelectorAll("span");let r=!1;t.forEach((e=>{e.classList.contains("red-disabled-text")&&(r=!0)}));const s=e.parentElement.parentElement.querySelector("button");r?s.classList.add("red-disabled-text"):s.classList.remove("red-disabled-text")}if(e.classList.contains("building-purchase-button"))return;"energy"!==t&&"scienceUpgrade"!==t&&(getElements()[t+"Rate"].textContent.includes("-")?getElements()[t+"Rate"].classList.add("red-disabled-text"):getElements()[t+"Rate"].classList.remove("red-disabled-text"))}}}export function setSellFuseCreateTextDescriptionClassesBasedOnButtonStates(e,t){if("create"===t){const t=e.parentElement.nextElementSibling.querySelector("label");t.textContent.includes("!")?t.classList.add("warning-orange-text"):t.classList.remove("warning-orange-text")}else if("green"===t){const t=e.parentElement.nextElementSibling.querySelector("label");t.classList.remove("red-disabled-text"),t.classList.add("unlocked-tech"),t.classList.add("green-ready-text"),t.textContent="Researched"}else if("fuse"===t){const t=e.parentElement.nextElementSibling.querySelector("label");t.textContent.includes("!!")?(e.classList.add("warning-orange-text"),e.classList.remove("red-disabled-text"),t.classList.remove("warning-orange-text"),t.classList.add("red-disabled-text")):t.textContent.includes("!")?(e.classList.add("warning-orange-text"),t.classList.add("warning-orange-text")):(e.classList.remove("warning-orange-text"),t.classList.remove("warning-orange-text"),t.classList.remove("red-disabled-text"))}}const updateQuantityDisplays=(e,t,r,s,a,c,n)=>{const[o,i]=s||[null,null],[u,l]=a||[null,null],[d,g]=c||[null,null];if(n){if(e&&r){let s="";s="€"===r?t+r:r===getCurrencySymbol()?r+t:t+" "+r;const a=[];null!=o&&i&&""!==i.trim()&&a.push(o+" "+i),null!=u&&l&&""!==l.trim()&&a.push(u+" "+l),null!=d&&g&&""!==g.trim()&&a.push(d+" "+g),e.innerHTML="";const c=document.createElement("span");c.className="currency-price",c.innerHTML=s,e.appendChild(c),a.length>0&&a.forEach(((t,r)=>{const s=document.createElement("span");s.className=`resource-price${r+1}`,s.innerHTML=`, ${t}`,e.appendChild(s)}))}}else e&&r>=0?e===getElements().energyQuantity?getResourceDataObject("buildings",["energy","batteryBoughtYet"])?e.textContent=Math.floor(t)+"/"+Math.floor(r):e.textContent=Math.floor(t):e===getElements().researchQuantity||e.id&&e.id.includes("power")?e.textContent=Math.floor(t):e.textContent=Math.floor(t)+"/"+Math.floor(r):e&&(e.textContent=Math.floor(t)),e&&r&&t===r&&e.classList.add("green-ready-text"),e&&e.classList.contains("green-ready-text")&&t!==r&&e.classList.remove("green-ready-text")};export function gain(e,t,r,s,a,c,n){let o,i,u;if(o="research"===c?"research":"techs"===c?"techs":"scienceUpgrade"===c?"scienceUpgrade":"energy"===c?"energy":n.slice(0,-1),i=r&&"techUnlock"===r?getResourceDataObject("techs",[e,"price"]):r&&r.startsWith("science")?getResourceDataObject("research",["upgrades",r,"quantity"]):r&&r.startsWith("power")||r&&r.startsWith("battery")?getResourceDataObject("buildings",["energy","upgrades",r,"quantity"]):getResourceDataObject(n,r&&"autoBuyer"===r?[c,"upgrades","autoBuyer",a,"quantity"]:[c,"quantity"]),s)"techUnlock"===s?setResourceDataObject(getResourceDataObject("research",["quantity"])-i,"research",["quantity"]):setResourceDataObject(i+e,n,[c,"upgrades","autoBuyer",a,"quantity"]);else if("scienceUpgrade"===o)setResourceDataObject(i+e,"research",["upgrades",r,"quantity"]);else if("energy"===o){if(setResourceDataObject(i+e,"buildings",["energy","upgrades",r,"quantity"]),r.startsWith("power")){const e=getResourceDataObject("buildings",["energy","upgrades",r,"fuel"])[0],t=getResourceDataObject("buildings",["energy","upgrades",r,"fuel"])[1],s=getResourceDataObject("buildings",["energy","upgrades",r,"fuel"])[2],a=getResourceDataObject(s,[e]);if(setResourceDataObject(a.usedForFuelPerSec+t,s,[e,"usedForFuelPerSec"]),getActivatedFuelBurnObject(e)){const r=getResourceDataObject(s,[e,"rate"]);setResourceDataObject(r-t,s,[e,"rate"])}}}else{if("resource"===o||"compound"===o){const r=getResourceDataObject(n,[c,"storageCapacity"]);return void(i<r?(getElements()[t].classList.remove("green-ready-text"),setResourceDataObject(i+e,n,[c,"quantity"])):setResourceDataObject(r,n,[c,"quantity"]))}"research"===o&&(getElements()[t].classList.remove("green-ready-text"),setResourceDataObject(i+e,"research",["quantity"]))}let l,d,g,y=0,p=0,m=0;if("research"===c)d=getResourceDataObject("research",["upgrades",r]);else{if("techs"===c)return void sortTechRows(!1);d="scienceUpgrade"===c?getResourceDataObject("research",["upgrades",r]):"energy"===c?getResourceDataObject("buildings",["energy","upgrades",r]):getResourceDataObject(n,[c])}s?(u=d.upgrades.autoBuyer[a].price,l=d.upgrades.autoBuyer[a].setPrice):(u=d.price,"energy"===c&&(y=d.resource1Price[0],p=d.resource2Price[0],m=d.resource3Price[0]),l=d.setPrice);let b="",R="",f="",O="",h="",j="",D=[[0,""],[0,""],[0,""]];"scienceUpgrade"===c||"energy"===c?(g="cash","energy"===c&&(b=d.resource1Price[1],R=d.resource2Price[1],f=d.resource3Price[1],O=d.resource1Price[2],h=d.resource2Price[2],j=d.resource3Price[2]),D=[[y,b,O],[p,R,h],[m,f,j]]):g=d.screenName,setItemsToDeduct([g],[u],[n],D),setItemsToIncreasePrice(g,l,u,n,D)}export function increaseResourceStorage(e,t,r){let s,a=[];const c=getIncreaseStorageFactor();if("water"===t[0]){s=t;const e=getResourceDataObject(r[0],[t[0],"storageCapacity"]);for(let t=0;t<s.length;t++)t>0?a.push(.3*e):a.push(e-1)}else s=[t[0]],a[0]=getResourceDataObject(r[0],[s,"storageCapacity"])-1;setItemsToDeduct(s,a,r,[[0,""],[0,""],[0,""]]),deferredActions.push((()=>{const s=getResourceDataObject(r[0],[t[0],"storageCapacity"])*c;setResourceDataObject(s,r[0],[t[0],"storageCapacity"]),t.length>1&&setResourceDataObject(.3*s,r[1],[t[1],"currentSecondaryIncreasePrice"]),e.forEach((e=>{getElements()[e].classList.remove("green-ready-text")}))}))}export function revealElement(e){document.getElementById(e).classList.remove("invisible")}export function startUpdateTimersAndRates(e,t){e.startsWith("science")?startUpdateScienceTimers(e):e.startsWith("power")&&startUpdateEnergyTimers(e,t)}function startInitialTimers(){const e=getResourceDataObject("resources"),t=getResourceDataObject("compounds"),r=[1,2,3,4];for(const t in e)e.hasOwnProperty(t)&&r.forEach((e=>{const r=`${t}AB${e}`;timerManager.getTimer(r)||timerManager.addTimer(r,getTimerUpdateInterval(),(()=>{const r=getResourceDataObject("resources",[t,"quantity"]),s=getResourceDataObject("resources",[t,"storageCapacity"]);if(getPowerOnOff()){const a=getResourceDataObject("resources",[t,"upgrades","autoBuyer",`tier${e}`,"rate"])*getResourceDataObject("resources",[t,"upgrades","autoBuyer",`tier${e}`,"quantity"]);setResourceDataObject(Math.min(r+a,s),"resources",[t,"quantity"]);const c=getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier1","rate"])*getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier1","quantity"])+getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier2","rate"])*getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier2","quantity"])+getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier3","rate"])*getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier3","quantity"])+getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier4","rate"])*getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier4","quantity"]),n="carbon",o=getResourceDataObject("buildings",["energy","upgrades","powerPlant1","fuel"])[1]*getResourceDataObject("buildings",["energy","upgrades","powerPlant1","quantity"]);let i=0;getBuildingTypeOnOff("powerPlant1")&&(t===n&&(i=o,1===e&&(setCanAffordDeferred(!0),deferredActions.push((()=>{getCanAffordDeferred()&&(setResourceDataObject(c+i,"resources",[t,"rate"]),setResourceDataObject(Math.min(getResourceDataObject("resources",[t,"quantity"])-i,s),"resources",[t,"quantity"])),setCanAffordDeferred(null)})))),"solar"!==t&&(getElements()[`${t}Rate`].textContent=`${((c-i)*getTimerRateRatio()).toFixed(1)} / s`))}else if(1===e){const e=getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier1","rate"])*getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier1","quantity"]);setResourceDataObject(Math.min(r+e,s),"resources",[t,"quantity"]);const a=getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier1","rate"])*getResourceDataObject("resources",[t,"upgrades","autoBuyer","tier1","quantity"]);setResourceDataObject(a,"resources",[t,"rate"]),"solar"!==t&&(getElements()[`${t}Rate`].textContent=`${(a*getTimerRateRatio()).toFixed(1)} / s`)}}))}));for(const e in t)t.hasOwnProperty(e)&&r.forEach((t=>{const r=`${e}AB${t}`;timerManager.getTimer(r)||timerManager.addTimer(r,getTimerUpdateInterval(),(()=>{const r=getResourceDataObject("compounds",[e,"quantity"]),s=getResourceDataObject("compounds",[e,"storageCapacity"]);if(getPowerOnOff()){const a=getResourceDataObject("compounds",[e,"upgrades","autoBuyer",`tier${t}`,"rate"])*getResourceDataObject("compounds",[e,"upgrades","autoBuyer",`tier${t}`,"quantity"]);setResourceDataObject(Math.min(r+a,s),"compounds",[e,"quantity"]);let c=getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier1","rate"])*getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier1","quantity"])+getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier2","rate"])*getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier2","quantity"])+getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier3","rate"])*getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier3","quantity"])+getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier4","rate"])*getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier4","quantity"]);e===getStarSystemDataObject(getCurrentStarSystem(),["precipitationType"])&&(c+=getCurrentPrecipitationRate());const n="diesel",o=getResourceDataObject("buildings",["energy","upgrades","powerPlant3","fuel"])[1]*getResourceDataObject("buildings",["energy","upgrades","powerPlant3","quantity"]);let i=0;getBuildingTypeOnOff("powerPlant3")&&e===n&&(i=o,1===t&&(setResourceDataObject(c+i,"compounds",[e,"rate"]),setResourceDataObject(Math.min(getResourceDataObject("compounds",[e,"quantity"])-i,s),"compounds",[e,"quantity"]))),getElements()[`${e}Rate`].textContent=`${((c-i)*getTimerRateRatio()).toFixed(1)} / s`}else if(1===t){const t=getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier1","rate"])*getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier1","quantity"]);setResourceDataObject(Math.min(r+t,s),"compounds",[e,"quantity"]);let a=getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier1","rate"])*getResourceDataObject("compounds",[e,"upgrades","autoBuyer","tier1","quantity"]);e===getStarSystemDataObject(getCurrentStarSystem(),["precipitationType"])&&(a+=getCurrentPrecipitationRate()),setResourceDataObject(a,"compounds",[e,"rate"]),getElements()[`${e}Rate`].textContent=`${(a*getTimerRateRatio()).toFixed(1)} / s`}else e===getStarSystemDataObject(getCurrentStarSystem(),["precipitationType"])&&(setResourceDataObject(getCurrentPrecipitationRate(),"compounds",[e,"rate"]),getElements()[`${e}Rate`].textContent=`${(getCurrentPrecipitationRate()*getTimerRateRatio()).toFixed(1)} / s`)}))}));timerManager.addTimer("research",getTimerUpdateInterval(),(()=>{const e=getResourceDataObject("research",["quantity"]),t=getResourceDataObject("research",["rate"]),r=getResourceDataObject("research",["rate"])-getResourceDataObject("research",["ratePower"]);getPowerOnOff()?setResourceDataObject(e+t,"research",["quantity"]):setResourceDataObject(e+r,"research",["quantity"])})),timerManager.addTimer("energy",getTimerUpdateInterval(),(()=>{let e=0,t=getResourceDataObject("buildings",["energy","quantity"]);const r=getResourceDataObject("buildings",["energy","batteryBoughtYet"]),s=getResourceDataObject("buildings",["energy","storageCapacity"]);if(Math.floor(t)<=s)if(getPowerOnOff()){getBuildingTypeOnOff("powerPlant1")&&(e+=getResourceDataObject("buildings",["energy","upgrades","powerPlant1","purchasedRate"])),getBuildingTypeOnOff("powerPlant2")&&(e+=getResourceDataObject("buildings",["energy","upgrades","powerPlant2","purchasedRate"])*getCurrentStarSystemWeatherEfficiency()[1]),getBuildingTypeOnOff("powerPlant3")&&(e+=getResourceDataObject("buildings",["energy","upgrades","powerPlant3","purchasedRate"]));let a=e-getTotalEnergyUse();r&&(Math.floor(t)===s?a>=0?(setResourceDataObject(t,"buildings",["energy","quantity"]),getElements().energyQuantity.classList.remove("red-disabled-text"),getElements().energyQuantity.classList.add("green-ready-text"),a=0):(setResourceDataObject(t+a,"buildings",["energy","quantity"]),getElements().energyQuantity.classList.add("red-disabled-text"),getElements().energyQuantity.classList.remove("green-ready-text")):(setResourceDataObject(t+a,"buildings",["energy","quantity"]),getElements().energyQuantity.classList.remove("red-disabled-text"),getElements().energyQuantity.classList.remove("green-ready-text"))),getElements().energyRate.textContent=`${Math.floor(a*getTimerRateRatio())} KW / s`}else getElements().energyQuantity.classList.remove("red-disabled-text"),getElements().energyQuantity.classList.remove("green-ready-text"),getElements().energyRate.textContent="0 KW / s";else getElements().energyQuantity.classList.add("green-ready-text"),getElements().energyQuantity.classList.remove("red-disabled-text");t=getResourceDataObject("buildings",["energy","quantity"]),t<0&&setResourceDataObject(0,"buildings",["energy","quantity"]),setResourceDataObject(e,"buildings",["energy","rate"]);const a=getPowerOnOff();let c;if(r)setPowerOnOff(t>1e-5),c=getPowerOnOff();else{const t=e-getTotalEnergyUse();setPowerOnOff(t>0),c=getPowerOnOff()}if(!getPowerOnOff()&&a!==c){const e=Object.fromEntries(Object.entries(getResourceDataObject("buildings",["energy","upgrades"])).filter((([e])=>e.startsWith("power"))));Object.keys(e).forEach((e=>{const t=getResourceDataObject("buildings",["energy","upgrades",e,"fuel"])[0],r=getResourceDataObject("buildings",["energy","upgrades",e,"fuel"])[2];toggleBuildingTypeOnOff(e,!1),startUpdateTimersAndRates(e,"toggle"),addOrRemoveUsedPerSecForFuelRate(t,null,r,e,!0),setTrippedStatus(!0)}))}}));let s="weatherTimer";!function e(){function t(){const e=getStarSystemWeather(getCurrentStarSystem()),t=Object.keys(e),r=t.map((t=>e[t][0])),s=r.reduce(((e,t)=>e+t),0),a=Math.random()*s;let c=0,n="";for(let e=0;e<t.length;e++)if(c+=r[e],a<=c){n=t[e];break}const[o,i,u]=e[n],l=document.getElementById("stat7"),d=l.previousElementSibling;switch(n){case"sunny":l.classList.add("green-ready-text"),l.classList.remove("warning-orange-text"),l.classList.remove("red-disabled-text");break;case"cloudy":case"rain":l.classList.remove("green-ready-text"),l.classList.add("warning-orange-text"),l.classList.remove("red-disabled-text");break;case"volcano":l.classList.remove("green-ready-text"),l.classList.remove("warning-orange-text"),l.classList.add("red-disabled-text")}d.textContent=`${capitaliseString(getCurrentStarSystem())}:`,l.textContent=`${Math.floor(100*u)}% ${i}`,setCurrentStarSystemWeatherEfficiency([getCurrentStarSystem(),u,n])}t();const r=60*(Math.floor(3*Math.random())+1)*1e3,a=r/1e3;timerManager.getTimer(s)&&timerManager.removeTimer(s);let c=a,n=0,o=!1;setCurrentPrecipitationRate(0);const i=setInterval((()=>{c>0?("rain"!==getCurrentStarSystemWeatherEfficiency()[2]||o?o||(setCurrentPrecipitationRate(0),o=!0):(n=(Math.floor(4*Math.random())+1)/getTimerRateRatio(),setCurrentPrecipitationRate(n),o=!0),c-=1):clearInterval(i)}),1e3);timerManager.addTimer(s,r,(()=>{clearInterval(i),t(),e()}))}()}function startUpdateScienceTimers(e){let t,r=getResourceDataObject("research",["ratePower"]);const s=getResourceDataObject("research",["upgrades",e,"rate"]);getResourceDataObject("research",["upgrades",e,"energyUse"])>0&&(r=getResourceDataObject("research",["ratePower"])+s),t=getResourceDataObject("research",["rate"])+s,setResourceDataObject(r,"research",["ratePower"]),setResourceDataObject(t,"research",["rate"]),getElements().researchRate.textContent=`${(t*getTimerRateRatio()).toFixed(1)} / s`}function startUpdateEnergyTimers(e,t){if(e.startsWith("power")){let r=0;const s=getResourceDataObject("buildings",["energy","upgrades",e,"purchasedRate"]);"toggle"===t?getBuildingTypeOnOff(e)?getElements()[e+"Rate"].textContent=`${Math.floor(s*getTimerRateRatio())} KW / s`:getElements()[e+"Rate"].textContent="0 KW / s":"buy"===t&&(getElements()[e+"Rate"].textContent=`${Math.floor(s*getTimerRateRatio())} KW / s`),setResourceDataObject(r,"buildings",["energy","rate"])}}function formatAllNotationElements(e,t){const r=e.innerHTML.replace(/-?\d+(\.\d+)?/g,(r=>{let s=parseFloat(r);if(isNaN(s))return console.warn(`Invalid number found: ${r}`),r;if("normal"===t)return s;if("normalCondensed"===t){if("cashStat"===e.id){const e=(e,t)=>{const r=e/t,s=r%1;return 0===s||.1===s||.9===s?r.toFixed(0):r.toFixed(1)};if(s>=1e13){let e=Math.floor(Math.log10(s));const t=s/Math.pow(10,e),r=t%1;return`${0===r||.1===r||.9===r?t.toFixed(0):t.toFixed(1)}e${e}`}return s>=1e12?`${e(s,1e12)}e12`:s>=1e9?`${e(s,1e9)}B`:s>=1e6?`${e(s,1e6)}M`:s>=1e3?`${e(s,1e3)}K`:Math.round(s).toFixed(0)}if(s>=1e13){let e=Math.floor(Math.log10(s));return`${Math.floor(s/Math.pow(10,e)*10)/10}e${e}`}return s>=1e12?`${(Math.floor(s/1e12*10)/10).toFixed(1)}e12`:s>=1e9?`${(Math.floor(s/1e9*10)/10).toFixed(1)}B`:s>=1e6?`${(Math.floor(s/1e6*10)/10).toFixed(1)}M`:s>=1e3?`${(Math.floor(s/1e3*10)/10).toFixed(1)}K`:"techUnlock"===e.dataset.conditionCheck||"building"===e.dataset.type?s:s.toFixed(0)}}));e.innerHTML=r}function complexPurchaseBuildingFormatter(e,t){if("normalCondensed"===t){e.querySelectorAll("span").forEach(((e,t)=>{const r=e.textContent.trim(),s=r.split(" ");let a;a=0!==t?s[1]?.replace(/[^0-9.]/g,""):s[0].replace(/[^0-9.]/g,"");const c=formatNumber(a);if(0===t)"€"===getCurrencySymbol()?e.textContent=c+getCurrencySymbol():e.textContent=getCurrencySymbol()+c,s.length>1&&(e.textContent+=" "+s.slice(1).join(" "));else{const t=r.startsWith(",")?", ":"",a=s.slice(2).join(" ");e.textContent=`${t}${c}${a?" "+a:""}`}}))}}function formatNumber(e){const t=parseFloat(e);if(isNaN(t))return e;if(t>=1e13){let e=Math.floor(Math.log10(t));return`${(Math.floor(t/Math.pow(10,e)*10)/10).toFixed(1)}e${e}`}return t>=1e12?`${(Math.floor(t/1e12*10)/10).toFixed(1)}e12`:t>=1e9?`${(Math.floor(t/1e9*10)/10).toFixed(1)}B`:t>=1e6?`${(Math.floor(t/1e6*10)/10).toFixed(1)}M`:t>=1e3?`${(Math.floor(t/1e3*10)/10).toFixed(1)}K`:t.toFixed(0)}function complexSellStringFormatter(e,t){if("normalCondensed"===t){const t=e.parentElement,r=t.innerHTML.match(/>(.*?)</);if(r){const e=t.innerHTML.slice(0,r.index+1),s=t.innerHTML.slice(r.index+r[0].length-1),a=getTempRowValue();t.innerHTML=e+a+s,t.innerHTML.includes("-&gt; ")&&formatSellStringCondensed(t,/&gt; (-?\d+)(\s|$)/,5,1),t.innerHTML.includes(", ")&&formatSellStringCondensed(t,/, (\d+)\s/,2,1)}}}function formatSellStringCondensed(e,t,r,s){const a=e.innerHTML.match(t);if(a){const t=parseFloat(a[1]);let c;if(t<0)c=0;else if(t>=1e13){let e=Math.floor(Math.log10(t));c=`${(Math.floor(t/Math.pow(10,e)*10)/10).toFixed(1)}e${e}`}else c=t>=1e12?`${(Math.floor(t/1e12*10)/10).toFixed(1)}e12`:t>=1e9?`${(Math.floor(t/1e9*10)/10).toFixed(1)}B`:t>=1e6?`${(Math.floor(t/1e6*10)/10).toFixed(1)}M`:t>=1e3?`${(Math.floor(t/1e3*10)/10).toFixed(1)}K`:t.toFixed(0);const n=e.innerHTML.slice(0,a.index+r),o=e.innerHTML.slice(a.index+a[0].length-s);e.innerHTML=n+c+o}}function setAllOriginalFrameNumberValues(){const e=document.querySelectorAll(".notation"),t=getOriginalFrameNumbers(),r=new Set;e.forEach((e=>{const s=e.innerHTML,a=e.id?`#${e.id}`:`.${e.className}`;a in t||(t[a]={originalValue:s,elementSelector:a},r.add(a))})),setOriginalFrameNumbers(t)}function sortRowsByRenderPosition(e,t){const r=[];return e.forEach((e=>{let s=!1;const a=getResourceDataObject(t,[e.techName,"idForRenderPosition"]);if("techs"===t){const t=e.row.querySelector(".input-container button");"Researched"===t.textContent&&a<1e4&&(r.push({...e,adjustedPos:a+1e4}),s=!0),t.classList.contains("red-disabled-text")||(r.push({...e,adjustedPos:a-1e4}),s=!0)}s||(e.row.classList.contains("invisible")?r.push({...e,adjustedPos:a+1e4}):a>1e4?r.push({...e,adjustedPos:a-1e4}):r.push({...e,adjustedPos:a}))})),r.sort(((e,t)=>e.adjustedPos-t.adjustedPos))}function updateClassesInRowsToRender(){const e=getTemporaryRowsRepo("rows");e.forEach((e=>{const t=document.getElementById(e.row.id);if(t){const r=t.classList;e.classList=Array.from(r)}})),setTemporaryRowsRepo("noChange",e)}function setEnergyUse(){const e=getResourceDataObject("resources"),t=getResourceDataObject("compounds"),r=getResourceDataObject("research",["upgrades"]);let s=0,a=0,c=0;for(const t in e){const r=e[t],a=r.upgrades?.autoBuyer;if(a)for(let e of["tier1","tier2","tier3","tier4"]){const t=a[e];if(t){s+=(t.energyUse||0)*(t.quantity||0)}}}for(const e in t){const r=t[e],s=r.upgrades?.autoBuyer;if(s)for(let e of["tier1","tier2","tier3","tier4"]){const t=s[e];if(t){a+=(t.energyUse||0)*(t.quantity||0)}}}for(const e in r){const t=r[e];if(t){c+=(t.energyUse||0)*(t.quantity||0)}}setTotalEnergyUse(s+a+c)}export function setEnergyCapacity(e){const t=getResourceDataObject("buildings",["energy","storageCapacity"]),r=getResourceDataObject("buildings",["energy","upgrades","battery1","capacity"]),s=getResourceDataObject("buildings",["energy","upgrades","battery2","capacity"]),a=getResourceDataObject("buildings",["energy","upgrades","battery3","capacity"]);let c;switch(e){case"battery1":c=t+r;break;case"battery2":c=t+s;break;case"battery3":c=t+a}setResourceDataObject(c,"buildings",["energy","storageCapacity"])}function updateEnergyStat(e){const t=getResourceDataObject("buildings",["energy","rate"])*getTimerRateRatio()-getTotalEnergyUse()*getTimerRateRatio();getPowerOnOff()?e.textContent=`${Math.floor(t)} KW / s`:e.textContent="0 KW / s"}function getConstituentComponents(e){let t=0,r=0,s="",a=0,c="",n=0,o="",i=0,u="";const l=e.match(/(\d+(?:\.\d+)?(?:[KMGTPE]?)?)\s*/);l?t=l[1]:console.log("No match found for compound quantity.");const d=e.match(/\((\d+(?:\.\d+)?(?:[KMGTPE]?)?)\s*([a-zA-Z]+)/);d&&(r=d[1],s=d[2]);const g=e.match(/, (\d+(?:\.\d+)?(?:[KMGTPE]?)?)\s*([a-zA-Z]+)/);g&&(a=g[1],c=g[2]);const y=e.match(/(?:, \d+(?:\.\d+)?(?:[KMGTPE]?)?\s*[a-zA-Z]+){1}\s*,\s*(\d+(?:\.\d+)?(?:[KMGTPE]?)?)\s*([a-zA-Z]+)/);y&&(n=y[1],o=y[2]);const p=e.match(/(?:, \d+(?:\.\d+)?(?:[KMGTPE]?)?\s*[a-zA-Z]+){2}\s*,\s*(\d+(?:\.\d+)?(?:[KMGTPE]?)?)\s*([a-zA-Z]+)/);return p&&(i=p[1],u=p[2]),{compoundToCreateQuantity:t,constituentPartQuantity1:r,constituentPartName1:s,constituentPartQuantity2:a,constituentPartName2:c,constituentPartQuantity3:n,constituentPartName3:o,constituentPartQuantity4:i,constituentPartName4:u}}function unpackConstituentPartsObject(e){e.compoundToCreateQuantity&&(e.compoundToCreateQuantity=parseNumber(e.compoundToCreateQuantity));for(let t=1;t<=4;t++){let r=`constituentPartQuantity${t}`,s=e[r];s&&0!==s&&(e[r]=parseNumber(s));let a=`constituentPartName${t}`;e[a]&&(e[a]=e[a].toLowerCase())}return e}function parseNumber(e){if("string"!=typeof e)return e;const t={K:1e3,M:1e6,B:1e9,T:1e12,E:1e18,P:1e15};let r=e.match(/(\d+(?:\.\d+)?)([KMGTPE]?)?/);if(r){let[e,s,a]=r,c=parseFloat(s.replace(",",""));return a in t&&(c*=t[a]),c}return e}function normalizeAllQuantities(e){for(let t in e)if(e[t]<0){let r="error";const s=getResourceDataObject("resources"),a=getResourceDataObject("compounds");t in s?r="resources":t in a&&(r="compounds"),e[t]=0,setResourceDataObject(0,r,[t,"quantity"])}return e}export function addBuildingPotentialRate(e){const t=getResourceDataObject("buildings",["energy","upgrades",e]),r=t.quantity,s=t.rate;setResourceDataObject(r*s,"buildings",["energy","upgrades",e,"purchasedRate"])}export function toggleBuildingTypeOnOff(e,t){getBuildingTypeOnOff(e)!==t&&(setBuildingTypeOnOff(e,t),console.log(e+"switched on (true) or off (false): "+t))}export function addOrRemoveUsedPerSecForFuelRate(e,t,r,s,a){let c,n;const o=getResourceDataObject(r,[e,"usedForFuelPerSec"]),i=getResourceDataObject(r,[e,"rate"]);if(t)switch(t.textContent){case"Activate":c=!1,t.textContent="Deactivate",t.classList.remove("red-disabled-text"),t.classList.add("green-ready-text"),n=!c;break;case"Deactivate":c=!0,t.textContent="Activate",t.classList.remove("green-ready-text"),n=!c}else n=a?"tripped":"fuelExhausted";const u=getResourceDataObject(r,[e,"upgrades","autoBuyer","tier1","rate"])*getResourceDataObject(r,[e,"upgrades","autoBuyer","tier1","quantity"]);if(n&&"fuelExhausted"!==n&&"tripped"!==n&&"regularUpdate"!==n)return setResourceDataObject(i-o,r,[e,"rate"]),setActivatedFuelBurnObject(e,!0),!0;if("fuelExhausted"===n)getRanOutOfFuelWhenOn(s)?(setResourceDataObject(0+u,r,[e,"rate"]),setActivatedFuelBurnObject(e,!1)):(setResourceDataObject(i-o,r,[e,"rate"]),setActivatedFuelBurnObject(e,!0));else{if("tripped"!==n)return setResourceDataObject(i+o,r,[e,"rate"]),setActivatedFuelBurnObject(e,!1),!1;setResourceDataObject(u,r,[e,"rate"]),setActivatedFuelBurnObject(e,!1)}}export function checkPowerBuildingsFuelLevels(){const e=Object.fromEntries(Object.entries(getResourceDataObject("buildings",["energy","upgrades"])).filter((([e])=>e.startsWith("power"))));Object.keys(e).forEach((e=>{const t=getResourceDataObject("buildings",["energy","upgrades",e,"fuel"])[0],r=getResourceDataObject("buildings",["energy","upgrades",e,"fuel"])[2],s=getResourceDataObject("buildings",["energy","upgrades",e,"quantity"]);getResourceDataObject(r,[t,"quantity"])<=0&&s>0?(toggleBuildingTypeOnOff(e,!1),startUpdateTimersAndRates(e,"toggle"),setRanOutOfFuelWhenOn(e,!0),addOrRemoveUsedPerSecForFuelRate(t,null,r,e,!1)):s>0&&getRanOutOfFuelWhenOn(e)&&setRanOutOfFuelWhenOn(e,!1)}))}export function offlineGains(e){const t=getResourceDataObject("resources"),r=getResourceDataObject("compounds"),s=Object.keys(t),a=Object.keys(r),c={},n={},o={},i={};s.forEach((e=>{c[e]={rate:getResourceDataObject("resources",[e,"rate"]),quantity:getResourceDataObject("resources",[e,"quantity"]),storageCapacity:getResourceDataObject("resources",[e,"storageCapacity"])}})),a.forEach((e=>{n[e]={rate:getResourceDataObject("compounds",[e,"rate"]),quantity:getResourceDataObject("compounds",[e,"quantity"]),storageCapacity:getResourceDataObject("compounds",[e,"storageCapacity"])}}));const u=getResourceDataObject("buildings",["energy","batteryBoughtYet"]);o.energy={rate:u?getResourceDataObject("buildings",["energy","rate"])-getResourceDataObject("buildings",["energy","consumption"]):0,quantity:getResourceDataObject("buildings",["energy","quantity"])},i.research={rate:getResourceDataObject("research",["rate"]),quantity:getResourceDataObject("research",["quantity"])};const l={rate:{resources:Object.fromEntries(Object.entries(c).map((([e,t])=>[e,t.rate]))),compounds:Object.fromEntries(Object.entries(n).map((([e,t])=>[e,t.rate]))),energy:o.energy.rate,research:i.research.rate},quantity:{resources:Object.fromEntries(Object.entries(c).map((([e,t])=>[e,t.quantity]))),compounds:Object.fromEntries(Object.entries(n).map((([e,t])=>[e,t.quantity]))),energy:o.energy.quantity,research:i.research.quantity}},d=getLastSavedTimeStamp(),g=(new Date).toISOString(),y=Math.floor((new Date(g).getTime()-new Date(d).getTime())/1e3),p=(e,t=1)=>Object.fromEntries(Object.entries(e).map((([e,r])=>[e,r*t*y]))),m={resources:p(l.rate.resources,getTimerRateRatio()),compounds:p(l.rate.compounds,getTimerRateRatio()),energy:l.rate.energy*getTimerRateRatio()*y,research:l.rate.research*getTimerRateRatio()*y};Object.entries(m.resources).forEach((([e,t])=>{const r=getResourceDataObject("resources",[e,"quantity"]),s=c[e].storageCapacity,a=Math.min(r+t,s);setResourceDataObject(a,"resources",[e,"quantity"])})),Object.entries(m.compounds).forEach((([e,t])=>{const r=getResourceDataObject("compounds",[e,"quantity"]),s=n[e].storageCapacity,a=Math.min(r+t,s);setResourceDataObject(a,"compounds",[e,"quantity"])}));const b=getResourceDataObject("buildings",["energy","quantity"]);setResourceDataObject(b+m.energy,"buildings",["energy","quantity"]);const R=getResourceDataObject("research",["quantity"]);setResourceDataObject(R+m.research,"research",["quantity"]),e||showNotification("Offline Gains Added!","info"),console.log("Offline Gains:",m),console.log("Time Offline (seconds):",y)}export function setAllCompoundsToZeroQuantity(){Object.keys(getResourceDataObject("compounds")).forEach((e=>{setResourceDataObject(0,"compounds",[e,"quantity"])}))}export function setGameState(e){switch(console.log("Setting game state to "+e),setGameStateVariable(e),e){case getMenuState():getElements().menu.classList.remove("d-none"),getElements().menu.classList.add("d-flex"),getElements().statsContainer.classList.remove("d-flex"),getElements().statsContainer.classList.add("d-none"),getElements().tabsContainer.classList.remove("d-flex"),getElements().tabsContainer.classList.add("d-none"),getElements().mainContainer.classList.remove("d-flex"),getElements().mainContainer.classList.add("d-none");break;case getGameVisibleActive():getElements().menu.classList.remove("d-flex"),getElements().menu.classList.add("d-none"),getElements().statsContainer.classList.remove("d-none"),getElements().statsContainer.classList.add("d-flex"),getElements().tabsContainer.classList.remove("d-none"),getElements().tabsContainer.classList.add("d-flex"),getElements().mainContainer.classList.remove("d-none"),getElements().mainContainer.classList.add("d-flex"),manageTabSpecificUi()}}